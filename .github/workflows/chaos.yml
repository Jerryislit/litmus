- name: Apply ChaosEngine (pod-delete)
  run: |
    cat <<'EOF' | kubectl apply -f -
    apiVersion: litmuschaos.io/v1alpha1
    kind: ChaosEngine
    metadata:
      name: pod-delete-engine
      namespace: litmus
    spec:
      appinfo:
        appns: default
        applabel: "app=demo-nginx"
        appkind: deployment
      engineState: "active"
      chaosServiceAccount: litmus-admin
      experiments:
      - name: pod-delete
        spec:
          components:
            env:
            - name: TOTAL_CHAOS_DURATION
              value: "30"
            - name: CHAOS_INTERVAL
              value: "10"
            - name: FORCE
              value: "false"
    EOF

- name: Wait for ChaosResult verdict
  run: |
    set -e
    for i in {1..60}; do
      verdict=$(kubectl get chaosresult -n litmus pod-delete-result -o jsonpath='{.status.experimentstatus.verdict}' 2>/dev/null || true)
      if [ "$verdict" = "Pass" ]; then
        echo "✅ Chaos passed"; exit 0
      elif [ "$verdict" = "Fail" ]; then
        echo "❌ Chaos failed"; exit 1
      else
        echo "Waiting for verdict... ($verdict)"; sleep 10
      fi
    done
    echo "Timed out waiting for ChaosResult"; exit 1
``
